# 7. 쿠폰

## 요구사항 분석

### 쿠폰
- 이커머스에서의 쿠폰은 지정된 상품을 구매하기 전 단계에서 사용자가 선택하고 가격을 할인받을 수 있도록 하는 정책중 하나
- 정책이기 때문에 쿠폰의 구현 방법과 적용 방법은 정하기 나름이라고 생각
- 쿠폰의 궁극적인 목적은 사용자를 유입시키기 위함. 악성재고 처리도 포함.

## 쿠폰 사용 플로우

#### 1. 쿠폰 발급 방식
- 쿠폰은 사용자가 상품 상세를 들어갔을 때 연관된 쿠폰을 받을 수 있도록 한다.
- 쿠폰은 총 3가지 정도를 가지도록 한다.
  - 전체 적용 가능 쿠폰, 단일 상품에 적용 가능한 쿠폰, 전체에 적용 가능한 쿠폰
- 사용자가 상품과 대응하는 쿠폰 리스트를 조회하고 리스트에서 쿠폰 받기를 클릭해서 쿠폰을 저장한다.

#### 2. 쿠폰 발급
- 발급된 쿠폰은 사용자의 userId와 대응하도록 별도의 테이블에서 관리된다.
- 쿠폰의 유효기간은 쿠폰마다 다르게 설정하는게 맞지만, 기본적으로는 발급시간 기준 30일로 정의한다.
- 추후 발급시간이 유동적으로 변경되어야 하는 경우를 고려해야한다.
- 발급 시점에 만료일시를 계산하여 저장한다 (발급시간 + 유효기간).
- 동일한 쿠폰은 한번 밖에 발급받지 못하도록 제한한다. exist로 확인

#### 3. 만료 처리 정책
- 만료되면 사용 불가능 상태로 백엔드에서 변경한다.
- 총 2가지의 사용 불가능 상태 변경이 있다.
- 제일 중요한 것은 만료된 것을 사용하려 할 때 사용하지 못하도록 막아준다.
- 두번째는, 사용자가 사용하지 않아도 자동으로 상태를 변경해주어야 한다. 배치 처리를 통해 일정한 시간에 모든 쿠폰을 확인하여 만료상태를 변경해준다.