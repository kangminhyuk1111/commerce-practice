# 3. 리뷰

## 요구사항 분석

### 화면 요약
- 리뷰 테이블은 작성대상, 제목, 컨텐츠(글), 별점, 작성자를 가지도록한다.
  - 작성대상이 추가되는 경우가 발생할 수 있음 ex) 판매자 리뷰.. ReviewTargetType이라는 enum을 도입
  - ReviewTargetType을 통해 PRODUCT, SELLER.. 등등 관리, 구분이 가능함
- Review는 구매자가 상품에 대해서 1가지만의 리뷰를 작성할 수 있다.
  - reviewKey라는 unique 컬럼을 만들어준다.
  - reviewKey는 특정 문자열로 이루어져서 DB에 저장시키고 DB검증을 통해 이미 key가 존재한다면 더 이상 작성이 불가능 하도록 막아준다.
  - 막는건 리뷰 정책 검증 객체에서 하도록 한다.
  - reviewKey는 발급방식 변경이 가능하기 때문에 ReviewKeyGenerator.generateKey() 메서드를 통해 만들어주도록 한다.
- 여러가지 규제 사항이 존재하는데 거기에 대해서 고민해봐야한다.
  - ReviewPolicyValidator(리뷰 정책 검증)객체를 만들어서 리뷰가 작성되기 이전에 검증하도록 만들어준다. 

### Review 테이블 구성
- Long id: 고유 ID
- Long targetId: 리뷰를 작성할 대상의 ID
- String reviewKey: 1인 1리뷰만 가능하도록 정책적으로 구성되었기 때문에 별도의 컬럼으로 구분해줘야함 그것을 reviewKey로 해결 가능
- ReviewTargetType reviewTargetType: 추후 확장성을 고려해 현재는 상품밖에 없지만, 판매자 리뷰, 구매자 리뷰..등 확장가능한 형태로 구현이 가능함
- String title, String description: 제목, 컨텐츠(글)
- Rating rating: 리뷰 별점, enum으로 관리, 1~5 까지의 정수
- Long userId: 리뷰 작성자의 ID

### reviewKey 구성 방법
- reviewKey는 reviewKeyGenerator에서 생성한다.
- 매개변수는 userId, targetId, reviewTargetType을 받는다.
- {reviewTargetType}-{targetId}-{userId} 형식으로 구성된다.

### 리뷰 정책 검증
- [ ] 중복 리뷰 여부 (reviewKey 존재 확인)
- [ ] 구매 여부 (구매하지 않은 대상에 리뷰 작성 방지)
- [ ] 리뷰 작성 기간 (구매 후 N일 이내만 작성 가능)

### 추후 개선 사항
- review가 수정이 가능하다면 history 테이블 만들기